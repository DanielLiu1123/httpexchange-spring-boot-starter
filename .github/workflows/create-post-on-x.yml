name: Create Tweet on X

on:
  push:
    branches:
      - feat-x

jobs:
  create-post-on-X:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1
#      - name: Setup Node
#        uses: actions/setup-node@v4
#        with:
#          node-version: 22
#          cache: yarn
#          cache-dependency-path: ./tools/post-on-x/yarn.lock
#      - name: Create post on X
#        working-directory: ./tools/post-on-x
#        env:
#          X_CONSUMER_API_KEY: ${{ secrets.X_CONSUMER_API_KEY }}
#          X_CONSUMER_API_SECRET_KEY: ${{ secrets.X_CONSUMER_API_SECRET_KEY }}
#          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
#          X_ACCESS_TOKEN_SECRET: ${{ secrets.X_ACCESS_TOKEN_SECRET }}
#        run: |
#          yarn install
#          yarn start
      - uses: actions/setup-go@v5
        with:
          go-version: stable
      - name: Create Tweet on X
        run: |
          go install github.com/DanielLiu1123/xcli/cmd/xcli@latest
          
          COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
          xcli tweet create --text="${COMMIT_MESSAGE}" \
                            --api-key="${{ secrets.X_CONSUMER_API_KEY }}" \
                            --api-secret="${{ secrets.X_CONSUMER_API_SECRET_KEY }}" \
                            --access-token="${{ secrets.X_ACCESS_TOKEN }}" \
                            --access-secret="${{ secrets.X_ACCESS_TOKEN_SECRET }}"
